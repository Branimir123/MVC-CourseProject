@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Scripts{
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.10.2/jquery-ui.min.js"></script>
    <script type="text/javascript">

        // Create progressbar
        $(function () {
            $("#progressbar").progressbar({
                value: 0
            });
        });

        // Add a timer to check uploading progress
        var timer;
        $(function () {
            timer = setTimeout(function () {
                checkUploading();
            }, 500);
        });

        // Checks uploading progress
        function checkUploading() {
            $.ajax({
                type: "POST",
                url: "/Home/Progress/",
                dataType: "json",
                success: function (p) {
                    $("#progressbar").progressbar({
                        value: p.progress
                    });

                    if (p.progress == 100) { location.reload(); }
                    else {
                        timer = setTimeout(function () {
                            checkUploading();
                        }, 500);
                    }
                },

            });
        }

    </script>
}

<form>
    @Model.Cloudinary.Api.BuildUploadForm("image_id", "auto",
    new SortedDictionary<string, object>() { },
    null)
</form>

<div id="waitscreen">
    <div class="caption">Uploading, please wait...</div>
    <div id="progressbar"></div>
    <div class="public_id">
        If your browser does not support javascript, just refresh the page...
    </div>
</div>